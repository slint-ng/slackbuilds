#
# Maintainer : Caleb McKay <caleb@candj.us>
# Contributor : Romain Gautier <romain.gautier@nimamoh.net>,Jameson Pugh <imntreal@gmail.com>
#
# Included in and adapted to Slint by Didier Spaier didieratslintdotfr

pkgname=btrfsmaintenance
pkgver=0.5.2
pkgrel=1slint
slackdesc="$pkgname (btrfs maintenance scripts)"
url='https://github.com/kdave/btrfsmaintenance'
license=('GPL2')
depends=('bash')
conflicts=("${pkgname}-git")
backup=(etc/default/btrfsmaintenance)
source=("btrfsmaintenance-${pkgver}.tar.gz" "btrfsmaintenance")
docs=("CHANGES*" "COPYING*" "README.html")
doinst() {
	sh usr/sbin/btrfsmaintenance-refresh-cron.sh
}

build() {
  cd "${pkgname}-${pkgver}"
  sed -E -i 's|/etc/sysconfig/|/etc/default/|' btrfsmaintenance-refresh.path
  mkdir -p $PKG/etc/default
  chmod 755 $PKG/etc/default
  cp $SRC/btrfsmaintenance $PKG/etc/default || exit 1
  install -dm755 "$PKG/usr/share/btrfsmaintenance"
  install -Dm755 btrfs-*.sh btrfsmaintenance-functions  "$PKG/usr/share/btrfsmaintenance"
  mkdir -p $PKG/usr/sbin
  cp btrfsmaintenance-refresh-cron.sh $PKG/usr/sbin
  mkdir -p $PKG/usr/man/man8
  gzip -c README.man > $PKG/usr/man/man8/btrfsmaintenance.8.gz || exit
  chmod 755 $PKG/usr/sbin
  pandoc -s -f gfm -t html5 -o $SRC/README.html README.md
}

# vim:set ts=2 sw=2 et:
