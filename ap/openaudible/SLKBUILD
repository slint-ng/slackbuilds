# Maintainer: kausban <mail at kausban com> for Arch
# Adapted to Slint by Didier Spaier diideratslintdotfr
pkgname=openaudible-bin
pkgver=4.5.3
pkgrel=1
slackdesc=\
(
#|-----handy-ruler------------------------------------------------------|
"$pkgname (cross-platform audiobook manager)"
"openaudible is designed for Audible users. Manage all your audiobooks"
"with this easy-to-use desktop application"
)
arch=('x86_64')
url="https://openaudible.org"
license=('Apache')
depends=("desktop-file-utils" "webkit2gtk")
source=("https://github.com/openaudible/openaudible/releases/download/v4.5.3/OpenAudible_4.5.3_x86_64.deb")
sha512sums=('a53bcdd2ffa4ed66dfca3d4bd3a79334f3fae9f63cb92f93556dc872999c85d00cbcb6a17af7ba0e834488688b1c848d644622360cbc742903939a7415cc390c')

doinst() {
# Update any existing icon cache files:
if find /usr/share/icons -maxdepth 2 2> /dev/null | grep -q icon-theme.cache ; then
  for theme_dir in /usr/share/icons/* ; do
    if [ -r ${theme_dir}/icon-theme.cache ]; then
      /usr/bin/gtk-update-icon-cache -t -f ${theme_dir} 1> /dev/null 2> /dev/null &
    fi
  done
  # This would be a large file and probably shouldn't be there.
  if [ -r /usr/share/icons/icon-theme.cache ]; then
    rm -f /usr/share/icons/icon-theme.cache
  fi
fi

# Update desktop database:
if [ -x /usr/bin/update-desktop-database ]; then
  /usr/bin/update-desktop-database /usr/share/applications 1> /dev/null 2> /dev/null
fi

# Update mime database:
if [ -x /usr/bin/update-mime-database -a -d /usr/share/mime ]; then
  /usr/bin/update-mime-database /usr/share/mime 1> /dev/null 2> /dev/null &
fi
}


build(){
    # Extract package data
    ar -x OpenAudible_4.5.3_x86_64.deb data.tar.gz
    tar xzf data.tar.gz -C "${PKG}"

    export I4J_INSTALL_LOCATION="/opt/OpenAudible"

	# symlink main binary
	install -d "${PKG}/usr/bin"
	ln -sf "$I4J_INSTALL_LOCATION/OpenAudible" "${PKG}/usr/bin/openaudible"
	ln -sf "$I4J_INSTALL_LOCATION/OpenAudible" "${PKG}/usr/bin/OpenAudible"

	# Install icons
	install -Dm644 "${PKG}/opt/OpenAudible/share/icons/hicolor/512x512/apps/org.openaudible.OpenAudible.png" "${PKG}/usr/share/icons/hicolor/512x512/apps/org.openaudible.OpenAudible.png"
	install -Dm644 "${PKG}/opt/OpenAudible/share/icons/hicolor/scalable/apps/org.openaudible.OpenAudible.svg" "${PKG}/usr/share/icons/hicolor/scalable/apps/org.openaudible.OpenAudible.svg"

	# Install metainfo files
	install -Dm644 "${PKG}/opt/OpenAudible/share/metainfo/org.openaudible.OpenAudible.metainfo.xml" \
			"${PKG}/usr/share/metainfo/org.openaudible.OpenAudible.metainfo.xml"

	# desktop entry
	desktop-file-install -m 644 --dir "${PKG}/usr/share/applications/" "${PKG}/opt/OpenAudible/share/applications/org.openaudible.OpenAudible.desktop"
}
