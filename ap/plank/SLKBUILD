# Maintainer:  Josh Ellithorpe <quest@mac.com>
# Included in Slint by Didier Spaier didieratslintdotfr

pkgname=plank-reloaded
pkgver=0.11.156
pkgrel=1slint
slackdesc=("plank (simple dock for X11 desktop environments)"
"Fork of the original plank project @ https://launchpad.net/plank "
"Home page: https://github.com/zquestz/plank-reloaded"
)
arch=('x86_64')
url='https://github.com/zquestz/plank-reloaded'
license=('GPL3')
depends=('atk' 'bamf' 'cairo' 'gdk-pixbuf2' 'glib2' 'glibc' 'gnome-menus'
         'gtk3' 'libgee' 'libwnck3' 'libx11' 'libxfixes' 'libxi' 'pango')
makedepends=('gnome-common' 'git' 'intltool' 'vala' 'meson' 'ninja')
provides=('plank')
conflicts=('plank')
source=("https://github.com/zquestz/plank-reloaded/archive/refs/tags/${pkgver}.tar.gz"
"startplank.desktop"
"plank-on"
"plank-off"
"README.Slint"
"applications.menu"
"slint-plank.gschema.override")
docs=("AUTHORS" "COPYING" "COPYING.LGPL2.1" "COPYRIGHT" "README.html" "README.Slint")
sha256sums=('8d4e8ef4bd97d68bf10dbec6bd2694d9b82fa35701827b3276a3360daa4d68e1')
options=("nosrcpack")
doinst() {
# Update desktop database:
if [ -x /usr/bin/update-desktop-database ]; then
  /usr/bin/update-desktop-database /usr/share/applications 1> /dev/null 2> /dev/null
fi
# glib schemas
if [ -x /usr/bin/glib-compile-schemas ]; then
  /usr/bin/glib-compile-schemas /usr/share/glib-2.0/schemas > /dev/null 2>&1
fi
# Update any existing icon cache files:
if find /usr/share/icons -maxdepth 2 2> /dev/null | grep -q icon-theme.cache ; then
  for theme_dir in /usr/share/icons/* ; do
    if [ -r ${theme_dir}/icon-theme.cache ]; then
      /usr/bin/gtk-update-icon-cache -t -f ${theme_dir} 1> /dev/null 2> /dev/null &
    fi
  done
  # This would be a large file and probably shouldn't be there.
  if [ -r /usr/share/icons/icon-theme.cache ]; then
    rm -f /usr/share/icons/icon-theme.cache
  fi
fi
rm -rf /usr/doc/plank-reloaded
}
build() {
  cd plank-reloaded-${pkgver} || exit
  pandoc -f gfm -t html5 -o README.html README.md
  meson setup --prefix=/usr build -Denable-apport=false -Dproduction-release=true
  meson compile -C build
  meson install --destdir="$PKG" -C build
  mkdir -p $PKG/usr/share/plank
  cd $SRC
  cp startplank.desktop $PKG/usr/share/plank
  mkdir -p "$PKG"/usr/bin
  cp plank-on plank-off $PKG/usr/bin
  chown -R root: "$PKG"/usr/bin
  chmod 755 "$PKG"/usr/bin/*
  # Provide an override fitting graphical environments with panels
  # either top or bottom and/or possibly onboard on bottom so put plank
  # on left by default.
  mkdir -p "$PKG"/usr/share/glib-2.0/schemas
  cp slint-plank.gschema.override "$PKG"/usr/share/glib-2.0/schemas
  chmod 644 "$PKG"/usr/share/glib-2.0/schemas/slint-plank.gschema.override
  # Put in /etc/xdg applications.menu (actually mate-applications.menu
  # renamed) so that it can be copied to ~/.config/menus even if mate
  # is not installed. This is done when starting matchbox-window-manager
  # for instance
  mkdir -p "$PKG"/etc/xdg/menus
  cp applications.menu "$PKG"/etc/xdg/menus/
  chmod 644 "$PKG"/etc/xdg/menus/applications.menu
}

# vim: ts=2 sw=2 et:
